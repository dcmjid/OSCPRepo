<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Bruteforce ASLR Locally</title>
</head><body>Thought process for RET2LIBC (at least in this example). <br/>
<br/>
# for i in `seq 0 20`; do ldd ovrfl | grep libc; done<br/>
Notice that the first 2 bytes and the last 3 bytes of the address don't change much. The 3rd byte rarely changes, and typically is one of two values (50/50 chance). With 2 bytes always changing, there are roughly 16 * 16 = 256 possible values for the bytes that are always changing. This is brute forcing ASLR. Brute forcing doesn't work when the program crashes (and you don't have a chance to restart it), but will work for this case. <br/>
<br/>
<br/>
With bruteforcing ASLR, a few things are needed:<br/>
<br/>
An address in range for LIBC. This is the address that libc will be at "sometimes"<br/>
An offset for SYSTEM<br/>
An offset for EXIT<br/>
An offset for /bin/sh<br/>
<br/>
<b>Finding an address in range for LIBC:</b><br/>
On the target victim machine:<br/>
for i in `seq 0 20`; do ldd ovrl | grep libc; done<br/>
<br/>
0xb75e0000<br/>
0xb7589000<br/>
0xb763d000<br/>
0xb75f8000<br/>
<br/>
Note the addresses above. Notice the range of these addresses.<br/>
<br/>
Alternatively, if you can load the binary in a debugger with peda, you can do:<br/>
(gdb) p system<br/>
<br/>
To obtain an address and use this as your base. Double check that it falls within the addresses above.<br/>
<br/>
<b>Finding offsets:</b><br/>
We will also have to calculate the exit addr and the arg addr. This can be done using offsets. Can use readelf to help identify offsets. <br/>
<br/>
<b>Get the system offset</b><br/>
$ readelf -s /lib/i386-linux-gnu/libc.so.6 | grep system<br/>
<br/>
<b>Get the exit offset</b><br/>
$ readelf -s /lib/i386-linux-gnu/libc.so.6 | grep exit<br/>
<br/>
<b>Use strings to obtain command to run (typically /bin/sh) and it's address</b><br/>
$ strings -a -t -x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh<br/>
<br/>
Can pad with 0 at front if the address isn't long enough</body></html>